(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7073],{65414:function(t,e,o){"use strict";o.d(e,{d:function(){return c},z:function(){return l}});var r=o(74817),n=o(71248),a=o(42745),i=o(82898),s=o(2002);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=n.forwardRef((t,e)=>{let{className:o,variant:n,size:i,asChild:l=!1,...d}=t,u=l?a.g7:"button";return(0,r.jsx)(u,{className:(0,s.cn)(c({variant:n,size:i,className:o})),ref:e,...d})});l.displayName="Button"},20117:function(t,e,o){"use strict";o.d(e,{Nw:function(){return n},Om:function(){return a},eL:function(){return i},lU:function(){return s},qm:function(){return c}});var r=o(42390);let n=["text","outline","referenceLoop","validate","success","addBlock"];class a{constructor(t,e,o){this.message=t,this.resumeable=null!=e&&e,this.underlyingError=o}}let i=t=>({loop:(0,r.p$)(t),status:"not-started",blockStatus:void 0,curBlockIndex:0,errorMessage:void 0,error:void 0,blockInput:"",blockResult:void 0,numFixesOnBlock:0}),s=t=>(null==t?void 0:t.status)==="running"||(null==t?void 0:t.status)==="pausing",c={"block-gen":"Generating","block-run":"Running","block-validate":"Validating","block-fix":"Fixing"}},74870:function(t,e,o){"use strict";o.d(e,{P5:function(){return Q},tw:function(){return _},Z5:function(){return p},N0:function(){return G},WW:function(){return S},_1:function(){return C},Hg:function(){return P},hx:function(){return R},qY:function(){return O},e_:function(){return j},yd:function(){return J},xN:function(){return N},Dm:function(){return V},zV:function(){return m},ln:function(){return K},z3:function(){return E},Z1:function(){return U},R6:function(){return X},II:function(){return A},eS:function(){return H},ei:function(){return y},nV:function(){return tt},Qm:function(){return tr},hP:function(){return T},bH:function(){return L},X$:function(){return D},gk:function(){return I},At:function(){return M},dq:function(){return tn},Jo:function(){return te},LW:function(){return to},Ot:function(){return $},Jh:function(){return g},$N:function(){return k},Lu:function(){return W},k6:function(){return q},rx:function(){return Y},A0:function(){return Z},Af:function(){return B},Nm:function(){return f},fA:function(){return v},y1:function(){return w},nE:function(){return z},Dq:function(){return ta},Hr:function(){return x},FW:function(){return b},Je:function(){return F},l$:function(){return h}});var r=o(76286),n=o(30836),a=o(29386),i=o(90335),s=o(42390),c=o(20373),l=o.n(c),d=o(20117);let u=t=>d.Nw.includes(t);function f(t){if(!t)return null;let e=t.trim().toLowerCase();return["javascript:","data:","vbscript:"].some(t=>e.startsWith(t))?null:e.startsWith("/")||function(t){try{return new URL(t,window.location.origin).origin===window.location.origin}catch(t){return!1}}(e)?t.trim():null}let p=async t=>{try{let e=await fetch("/api/admin/lookup/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:t})});if(!e.ok)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},h=async t=>{try{let e=await fetch("/api/admin/updateUseage/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw Error(await e.text())}catch(t){throw console.error(t),t}},y=async t=>{if(!t)return null;try{let e=await fetch("/api/user/phoneLookup/",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({phoneNumber:t,type:"e164"})});if(!e.ok)throw Error(await e.text());return(await e.json()).formatted}catch(t){return console.error(t),null}},w=async(t,e)=>{try{let o=await fetch("/api/user/signUp",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({localLoopData:t,affiliateCode:e})});if(!o.ok){let t=await o.text();throw Error(t||"Unable to upgrade your account. Please contact help@magicloops.dev")}return await o.json()}catch(t){throw console.error(t),t}},g=async t=>{try{let e=await fetch("/api/user/migrateLoops",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({localLoopData:t})});if(!e.ok){let t=await e.text();throw Error(t||"Unable to migrate your local loops. Please contact help@magicloops.dev")}return await e.json()}catch(t){throw console.error(t),t}},b=async(t,e)=>{try{let o=await fetch("/api/loop/updateVisibility",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t,visibility:e})});if(!o.ok){let t=await o.text();throw Error(t||"Unable to update Loop visibility. Please contact help@magicloops.dev")}}catch(t){throw console.error(t),t}},m=async(t,e,o)=>{try{let n=await fetch("/api/loop/copy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t,newName:e,timezone:o,isLocal:(0,s.D0)()})});if(!n.ok){let t=await n.text();throw Error(t||"Unable to copy Loop visibility. Please contact help@magicloops.dev")}let a=await n.json();return(0,r.J_)(a.newLoop),a}catch(t){throw console.error(t),t}},v=async(t,e)=>{let o=await fetch("/api/user/feedback",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,metadata:e})});if(!o.ok)throw Error(await o.text()||"Unable to send feedback")},k=async t=>{try{let e=await fetch("/api/user/newsletterSub",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!e.ok){let t=await e.text();throw Error(t||"Unable to subscribe to newsletter")}}catch(t){throw console.error(t),t}},T=async t=>{try{let e=await fetch("/api/loopGen/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t,timezone:(0,n.EP)()})});if(!e.ok||!e.body)throw Error(await e.text());let o=await e.json();return(0,r.J_)(o.loop),o}catch(t){throw console.error(t),t}},S=async t=>{try{let e=await fetch("/api/appGen/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...t})});if(!e.ok||!e.body)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}};async function E(t,e){try{let o=await fetch("/api/appGen/update",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({appGenId:t,...e})});if(!o.ok)throw Error(await o.text());let{appGen:r}=await o.json();return r}catch(t){throw console.error("Error updating AppGen:",t),t}}let O=async t=>{try{let e=await fetch("/api/appGen/".concat(t),{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok||!e.body)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},j=async t=>{try{let e=await fetch("/api/appGen/load-loops",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appId:t})});if(!e.ok||!e.body)throw Error(await e.text());let{loopData:o}=await e.json();return o}catch(t){throw console.error(t),t}};async function x(t,e,o){let{data:r,error:n}=await o.from("loopGen").update({creatorState:e}).eq("id",t).single();if(n)throw console.error("Error updating creatorState:",n),n;return r}let C=async(t,e,o,r)=>{let n;let s=[];try{let n=await fetch("/api/appGen/createSchema",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,description:e}),signal:o});if(!n.ok||!n.body)throw Error(await n.text());let a=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action)s.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type){let o=l().last(s);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}}r(s,null)}),c=!1,d=n.body.getReader(),u=new TextDecoder;for(;!c;){let t=await d.read(),e=u.decode(t.value,{stream:!0});a.ingestChunk(e,c),c=t.done}}catch(t){"AbortError"!==t.name&&(console.error(t),t=(0,a.f0)(t))}finally{r(s,n)}},P=async(t,e,o)=>{let r;let n=[];try{let r=await fetch("/api/appGen/finalize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t}),signal:e});if(!r.ok||!r.body)throw Error(await r.text());let a=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action)n.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type){let o=l().last(n);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}}o(n,null)}),s=r.body.getReader(),c=new TextDecoder,d=!1;for(;!d;){let{value:t,done:e}=await s.read();d=e;let o=c.decode(t||new Uint8Array,{stream:!0});a.ingestChunk(o,d)}}catch(t){"AbortError"!==t.name&&(console.error(t),r=(0,a.f0)(t))}finally{o(n,r)}},N=async(t,e,o,r)=>{let n;let s=[];try{let n=await fetch("/api/appGen/updateInterface",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,modificationRequest:e}),signal:o});if(!n.ok||!n.body)throw Error(await n.text());let a=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action)s.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type){let o=l().last(s);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}}r(s,null)}),c=n.body.getReader(),d=new TextDecoder,u=!1;for(;!u;){let{value:t,done:e}=await c.read();u=e;let o=d.decode(t||new Uint8Array,{stream:!0});a.ingestChunk(o,u)}}catch(t){"AbortError"!==t.name&&(console.error(t),n=(0,a.f0)(t))}finally{r(s,n)}},J=async(t,e,o,r)=>{let s;let c=[];try{let a=await fetch("/api/appGen/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,message:e,time:new Date().toISOString(),timezone:(0,n.EP)()}),signal:o});if(!a.ok||!a.body)throw Error(await a.text());let s=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action)c.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type){let o=l().last(c);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}else throw Error("No start message received")}r(c,null)}),d=!1,u=a.body.getReader(),f=new TextDecoder;for(;!d;){let t=await u.read(),e=f.decode(t.value,{stream:!0});s.ingestChunk(e,d),d=t.done}}catch(t){"AbortError"!==t.name&&(console.error(t),t=(0,a.f0)(t))}finally{r(c,s)}},R=async(t,e,o,r)=>{let n;let s=[];try{let a=await fetch("/api/appGen/gather-reqs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,message:e}),signal:o});if(!a.ok||!a.body)throw Error(await a.text());let c=new i.M(t=>{if("error"===t.type){n=t.data;return}if("start"===t.type&&"msg"===t.data.action)s.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type||"llm-function-call"===t.type){let o=l().last(s);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}else throw Error("Unknown function call")}n||r(s,null)}),d=!1,u=a.body.getReader(),f=new TextDecoder;for(;!d&&!n;){let t=await u.read(),e=f.decode(t.value,{stream:!0});c.ingestChunk(e,d),d=t.done}}catch(t){"AbortError"!==t.name&&(console.error(t),n=(0,a.f0)(t))}finally{r(s,n)}},D=async(t,e,o,r)=>{let s;let c=[];try{let a=await fetch("/api/loopCreator/outline",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,message:e,time:new Date().toISOString(),timezone:(0,n.EP)()}),signal:o});if(!a.ok||!a.body)throw Error(await a.text());let s=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action)c.push({role:"ai",type:t.data.type,content:""});else if("output"===t.type){let o=l().last(c);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}else throw Error("Unknown function call")}r(c,null)}),d=!1,u=a.body.getReader(),f=new TextDecoder;for(;!d;){let t=await u.read(),e=f.decode(t.value,{stream:!0});s.ingestChunk(e,d),d=t.done}}catch(t){"AbortError"!==t.name&&(console.error(t),t=(0,a.f0)(t))}finally{r(c,s)}},L=async(t,e,o,r)=>{let n;let s=[];try{let n=await fetch("/api/loopGen/message",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t,message:e}),signal:o});if(!n.ok||!n.body)throw Error(await n.text());let a=new i.M(t=>{if("error"===t.type)throw Error(t.data);if("start"===t.type&&"msg"===t.data.action){if(!u(t.data.type))throw Error("Invalid message type: ".concat(t.data.type));s.push({role:"ai",type:t.data.type,content:"",blockId:t.data.blockId})}else if("output"===t.type){let o=l().last(s);if(o){var e;o.content+=null!==(e=t.data.stdout)&&void 0!==e?e:""}else throw Error("Unknown function call")}r(s,null)}),c=!1,d=n.body.getReader(),f=new TextDecoder;for(;!c;){let t=await d.read(),e=f.decode(t.value,{stream:!0});a.ingestChunk(e,c),c=t.done}}catch(t){"AbortError"!==t.name&&(t=(0,a.f0)(t))}finally{r(s,n)}},M=async t=>{try{var e;let o=await fetch("/api/loopGen/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({genId:t})});if(!o.ok)throw Error(await o.text());return null!==(e=await o.json())&&void 0!==e?e:void 0}catch(t){return}},U=async function(){let{userId:t,limit:e=20,offset:o=0,searchQuery:r="",featured:n=!1,language:a,sortBy:i}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let s=await fetch("/api/discover/load?limit=".concat(e,"&offset=").concat(o,"&search=").concat(encodeURIComponent(r),"&featured=").concat(n,"&language=").concat(a,"&sortBy=").concat(i),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t})});if(!s.ok){let t=await s.text();throw Error(t||"Unable to load Public Loops")}return await s.json()}catch(t){throw console.error("Error loading discover:",t),t}},A=async()=>{try{var t;let e=await fetch("/api/apps/loadUserApps",{method:"POST",headers:{"Content-Type":"application/json"}});if(!e.ok){let t=await e.text();throw Error(t||"Unable to load Apps")}let o=await e.json();return null!==(t=o.apps)&&void 0!==t?t:[]}catch(t){throw console.error(t),t}},G=async(t,e)=>{try{let o=await fetch("/api/appGen/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({appGenId:t.id,deleteLoops:e})});if(!o.ok)throw Error(await o.text())}catch(t){return console.error(t),(0,a.f0)(t)}},I=async t=>{try{let e=await fetch("/api/loop/load",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t})});if(!e.ok)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},z=async t=>{try{let t=await fetch("/api/block/getTemplateBlocks",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error(await t.text());return await t.json()}catch(t){throw console.error(t),t}},F=async t=>{try{let e=await fetch("/api/block/updateTemplateBlocks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateBlocks:t})});if(!e.ok)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},_=async t=>{try{let e=await fetch("/api/block/addTemplateBlock",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({templateBlock:t})});if(!e.ok)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},B=async function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;try{let r=await fetch("/api/loop/runs",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t,limit:e,offset:o})});if(!r.ok)throw Error(await r.text());return await r.json()}catch(t){throw console.error(t),t}},W=async function(t,e){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,i=arguments.length>6&&void 0!==arguments[6]&&arguments[6];try{let s=await fetch("/api/loop/runData",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,loopName:e,ascend:o,showFiltered:r,limit:n,offset:a,sortByCredits:i})});if(!s.ok)throw Error(await s.text());return await s.json()}catch(t){throw console.error(t),t}},Z=async function(t,e){let o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{let r=await fetch("/api/loop/runDataLength",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,loopName:e,showFiltered:o})});if(!r.ok)throw Error(await r.text());return await r.json()}catch(t){throw t}},q=async(t,e,o,r,n)=>{try{let a=await fetch("/api/updateProfile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:t,fullName:e,avatarUrl:o,site:r,git:n})});if(!a.ok){let t=await a.json();throw Error(t.message)}return await a.json()}catch(t){return{success:!1,message:t.message}}},V=async t=>{try{let e=new FormData;e.append("file",t);let o=await fetch("/api/uploadAvatar",{method:"POST",body:e});if(!o.ok){let t=await o.json();throw Error(t.message)}return(await o.json()).avatarUrl}catch(t){return console.error("Error uploading avatar:",t),"failed"}},X=async t=>{try{let e=await fetch("/api/loop/run",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({runId:t})});if(!e.ok)throw Error(await e.text());return await e.json()}catch(t){throw console.error(t),t}},$=async t=>{try{let e=await fetch("/api/loop/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loop:t})});if(!e.ok)throw Error(await e.text())}catch(t){return console.error(t),(0,a.f0)(t)}};async function H(t){var e;let o=await fetch("/api/tags/loadUserTags",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t})});if(!o.ok)throw Error(await o.text()||"Failed to load tags");return(null!==(e=(await o.json()).tags)&&void 0!==e?e:[]).map(t=>({id:t.id,tag_name:t.tag_name,checkedForCurrentLoop:!!t.checkedForCurrentLoop}))}async function Q(t,e){try{let o=await fetch("/api/tags/addLoopTag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t,tagId:e})});if(!o.ok){let t=await o.text();throw Error(t||"Failed to attach tag")}}catch(t){throw console.error("[addLoopTag]",t),t}}async function Y(t,e){try{let o=await fetch("/api/tags/removeLoopTag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t,tagId:e})});if(!o.ok){let t=await o.text();throw Error(t||"Failed to remove tag")}}catch(t){throw console.error("[removeLoopTag]",t),t}}async function K(t,e){try{let o=await fetch("/api/tags/createTag",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t,tagName:e})});if(!o.ok){let t=await o.text();throw Error(t||"Failed to create tag")}return(await o.json()).tag}catch(t){throw console.error("[createTag]",t),t}}let tt=async t=>{try{let e=await fetch("/api/loop/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loop:t})});if(!e.ok)throw Error(await e.text())}catch(t){return console.error(t),(0,a.f0)(t)}},te=async(t,e)=>{try{let o=await fetch("/api/loop/publish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({loopId:t.id,publish:e})});if(!o.ok)throw Error(await o.text())}catch(t){return console.error(t),(0,a.f0)(t)}},to=async(t,e)=>{let o={};t.blocks.forEach(t=>o[t.id]={stdout:"",stderr:"",status:"not-ran"});let r={blockResults:o};try{let o=await fetch("/api/loop/run/".concat(t.id,"?type=manual"),{method:"POST",headers:{"X-Access-Token":"bud-stuff","Content-Type":"application/json"},body:JSON.stringify({input:e})});if(!o.ok||!o.body){r.error=await o.json();return}}catch(t){console.error(t),r.error=(0,a.f0)(t)}},tr=async(t,e,o,r)=>{let n={};t.blocks.forEach(t=>n[t.id]={stdout:"",stderr:"",status:"not-ran"});let s={blockResults:n};try{let n,a,c;let l=await fetch("/api/loop/dryRun",{method:"POST",headers:{"X-Access-Token":"bud-stuff","Content-Type":"application/json"},signal:e,body:JSON.stringify({loop:t,partialRunBlockIndex:o})});if(!l.ok||!l.body){s.error=await l.text(),r({...s},void 0,void 0);return}let d=new i.M(t=>{var e,o,i;if("metadata"===t.type)c=t.data;else if("overwrite"===t.type)s.blockResults=t.data.blockResults;else if("error"===t.type)for(let e of(s.error=t.data,Object.values(s.blockResults)))"running"===e.status&&(e.status="error");else if("start"===t.type){if(!(a=t.data.blockId))throw Error("Starting an event without a blockId");(n=null===(e=s.blockResults)||void 0===e?void 0:e[a]).status="running"}else if("end"===t.type){if(!n)throw Error("Got event for unknown block");n.status=n.stderr?"error":"success",n=void 0}else{if(!n)throw Error("Got event for unknown block");"llm-continue"===t.type?n.stderr+="ERROR: LLM response was cut-off because it was too long\n":"output"===t.type?(n.stdout+=null!==(o=t.data.stdout)&&void 0!==o?o:"",n.stderr+=null!==(i=t.data.stderr)&&void 0!==i?i:""):"logDuration"===t.type&&(n.durationMs=t.data.durationMs)}a&&n?(r({...s,blockResults:{...s.blockResults,[a]:{...n}}},a,c),c=void 0):r({...s},void 0,void 0)}),u=!1,f=l.body.getReader(),p=new TextDecoder;for(;!u;){let t=await f.read(),e=p.decode(t.value,{stream:!0});d.ingestChunk(e,u),u=t.done}}catch(t){if("AbortError"!==t.name)for(let e of(console.error(t),s.error=(0,a.f0)(t),Object.values(s.blockResults)))"running"===e.status&&(e.status="error")}finally{r({...s},void 0,void 0)}},tn=async(t,e,o,r,n)=>{let s={};t.blocks.forEach(t=>s[t.id]={stdout:"",stderr:"",status:"not-ran"});let c={blockResults:s};try{let a,s,l;let d=await fetch("/api/loop/publicRun",{method:"POST",headers:{"X-Access-Token":"bud-stuff","Content-Type":"application/json"},signal:e,body:JSON.stringify({loop:t,variables:o,runInput:r})});if(!d.ok||!d.body){c.error=await d.text(),n({...c},void 0,void 0);return}let u=new i.M(t=>{var e,o,r;if("metadata"===t.type)l=t.data;else if("overwrite"===t.type)c.blockResults=t.data.blockResults;else if("error"===t.type)for(let e of(c.error=t.data,Object.values(c.blockResults)))"running"===e.status&&(e.status="error");else if("start"===t.type){if(!(s=t.data.blockId))throw Error("Starting an event without a blockId");(a=null===(e=c.blockResults)||void 0===e?void 0:e[s]).status="running"}else if("end"===t.type){if(!a)throw Error("Got event for unknown block");a.status=a.stderr?"error":"success",a=void 0}else{if(!a)throw Error("Got event for unknown block");"llm-continue"===t.type?a.stderr+="ERROR: LLM response was cut-off because it was too long\n":"output"===t.type?(a.stdout+=null!==(o=t.data.stdout)&&void 0!==o?o:"",a.stderr+=null!==(r=t.data.stderr)&&void 0!==r?r:""):"logDuration"===t.type&&(a.durationMs=t.data.durationMs)}s&&a?(n({...c,blockResults:{...c.blockResults,[s]:{...a}}},s,l),l=void 0):n({...c},void 0,void 0)}),f=!1,p=d.body.getReader(),h=new TextDecoder;for(;!f;){let t=await p.read(),e=h.decode(t.value,{stream:!0});u.ingestChunk(e,f),f=t.done}}catch(t){if("AbortError"!==t.name)for(let e of(console.error(t),c.error=(0,a.f0)(t),Object.values(c.blockResults)))"running"===e.status&&(e.status="error")}finally{n({...c},void 0,void 0)}},ta=async(t,e)=>{try{let o=await fetch("/api/appGen/updateSubdomain",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({appGenId:t,newSubdomain:e})});if(!o.ok)throw Error(await o.text());return await o.json()}catch(t){throw console.error("Error updating subdomain:",t),t}}},29386:function(t,e,o){"use strict";o.d(e,{f0:function(){return r}});let r=t=>{var e,o,n,a,i;return(null==t?void 0:t.rawError)?r(t.rawError):"string"==typeof t?t:null!==(i=null!==(a=null!==(n=null!==(o=null!==(e=null==t?void 0:t.message)&&void 0!==e?e:null==t?void 0:t.cause)&&void 0!==o?o:null==t?void 0:t.code)&&void 0!==n?n:null==t?void 0:t.details)&&void 0!==a?a:null==t?void 0:t.stack)&&void 0!==i?i:"Unknown error"}},90335:function(t,e,o){"use strict";o.d(e,{M:function(){return n}});let r="⟡⧜⧝";class n{constructor(t){this.buffer="",this.emitEvent=(t,e)=>{this.eventReadyCallback(t,null!=e&&e)},this.ingestChunk=(t,e)=>{this.buffer+=t;let o=this.buffer.indexOf(r);for(;-1!==o;){let t=JSON.parse(this.buffer.slice(0,o));this.eventReadyCallback(t,e),this.buffer=this.buffer.slice(o+r.length),o=this.buffer.indexOf(r)}},this.eventReadyCallback=t}}},30836:function(t,e,o){"use strict";o.d(e,{EP:function(){return f},LU:function(){return y},Q6:function(){return u},Uy:function(){return i},WA:function(){return h},_5:function(){return p},v3:function(){return l},xz:function(){return d}});var r=o(26884),n=o.n(r),a=o(28179);let i=(t,e)=>{if(!e.cron||!e.timezone)return[];let o=[],r={currentDate:new Date,tz:e.timezone};try{let i=n().parseExpression(e.cron,r);for(let r=0;r<t;r++){let t=i.next(),r=a.ou.fromJSDate(t.toDate(),{zone:e.timezone}),n=r.toFormat("h:mm a"),s=r.toFormat("LLL-d, yyyy (EEE)");o.push("".concat(n," on ").concat(s))}}catch(t){}return o},s="h:mm a ZZZZ",c="LLL d, yyyy (EEE)",l=t=>{let e={currentDate:new Date,tz:t.timezone};try{let o=n().parseExpression(t.cron,e).next(),r=a.ou.fromJSDate(o.toDate(),{zone:t.timezone}),i=r.toFormat(s),l=r.toFormat(c);return"".concat(i," on ").concat(l)}catch(t){return""}},d=t=>{let e=a.ou.fromISO(t),o=e.toFormat(s),r=e.toFormat(c);return"".concat(o," on ").concat(r)},u=t=>t?a.ou.fromISO(t).toFormat("MMMM d, yyyy 'at' h:mm a"):"",f=()=>Intl.DateTimeFormat().resolvedOptions().timeZone;function p(t){return a.ou.fromJSDate(t).toLocaleString(a.ou.DATETIME_MED)}function h(t){return a.ou.fromJSDate(t).toFormat("hh:mm a")}function y(t){let e=Math.floor(t/36e5),o=Math.floor((t%=36e5)/6e4),r=Math.floor((t%=6e4)/1e3);t%=1e3;let n=[];return(e>0&&n.push("".concat(e," hour").concat(e>1?"s":"")),o>0&&n.push("".concat(o," minute").concat(o>1?"s":"")),r>0&&n.push("".concat(r," second").concat(r>1?"s":"")),t>0&&0===n.length&&n.push("< 1 second"),0===n.length)?"0 ms":n.join(", ")}},37281:function(){}}]);